# Функционал PWS

## Поиск песен

### Полнотекстовый поиск
- **Вход**: номер в сборнике ИЛИ произвольный текст
- **Поведение**: поиск по номерам, названиям, тексту песен
- **Результат**: `List<SongSearchResult>` с релевантностью и подсветкой совпадений
- **Use Cases**: `SearchSongsUseCase`, `SearchSongSuggestionsUseCase`

### Подсказки поиска
- Показываются по мере ввода
- Возвращают `SongSearchSuggestion` с предлагаемым текстом

## Просмотр сборников

### Список сборников
- Отображает все доступные сборники (Book)
- Каждый сборник имеет: название, описание, количество песен
- **Use Cases**: `GetBooksUseCase`

### Список песен сборника
- Показывает песни выбранного сборника
- Сортировка по номеру в сборнике
- **Use Cases**: `GetSongNumbersUseCase`

## Просмотр песни

### Экран песни
- Отображает полный текст песни
- Показывает метаданные: автор, тональность, стих из Библии
- **Use Cases**: `GetSongDetailUseCase`, `ObserveSongUseCase`

### Связанный контент
- **Теги**: категории песни (отображаются как chips)
- **Похожие песни**: ссылки на связанные песни (Song references)
- При нажатии на тег → переход к списку песен с этим тегом
- При нажатии на похожую песню → переход к этой песне

### Автоматическое добавление в историю
- Условие: песня открыта > 10 секунд
- Действие: создать запись в History
- **Use Cases**: `AddHistoryUseCase`

## Избранное

### Добавление в избранное
- Кнопка "в избранное" на экране песни
- Toggle: добавить/удалить
- **Use Cases**: `AddFavoriteUseCase`, `RemoveFavoriteUseCase`

### Список избранного
- Отображает все избранные песни пользователя
- Сортировка по дате добавления (новые сверху)
- **Use Cases**: `GetFavoritesUseCase`

## История

### Автоматическое отслеживание
- Песни добавляются после 10 сек просмотра
- Дублирование не происходит (обновляется timestamp)

### Просмотр истории
- Список просмотренных песен
- Сортировка по дате (недавние сверху)
- **Use Cases**: `GetHistoryUseCase`

## Теги / Категории

### Глобальные теги
- Определены на backend
- Только для чтения
- Примеры: "Рождество", "Пасха", "Прославление"

### Пользовательские теги
- Пользователь может создавать свои теги
- Назначать свои теги песням
- CRUD операции: создание, редактирование, удаление
- **Use Cases**: `CreateTagUseCase`, `UpdateTagUseCase`, `DeleteTagUseCase`

### Назначение тегов
- Добавить тег к песне
- Удалить тег с песни
- **Use Cases**: `AddSongTagUseCase`, `RemoveSongTagUseCase`

### Просмотр песен по тегу
- При нажатии на тег → список всех песен с этим тегом
- **Use Cases**: `GetSongsByTagUseCase`

## Редактирование песен (User Overrides)

### Концепция
- Глобальные песни неизменяемы
- Пользователь создает **override** (переопределение)
- При отображении: user override объединяется с глобальной песней

### Что можно переопределить
- Текст песни (lyric)
- Тональность
- Метаданные

### Merge стратегия
```
Отображаемая песня = Global Song + User Override
                     (override имеет приоритет)
```

## Планируемый функционал (Future)

### Пользовательские сборники
- Создание своих сборников
- Добавление песен в сборник
- Публикация сборника (запрос на добавление в глобальные)

### Публикация изменений
- Пользователь может предложить свои исправления
- После модерации — применяются к глобальной песне

---

## Матрица функционала по платформам

| Функционал            | Android/iOS  | Web/TG Mini App |
|-----------------------|--------------|-----------------|
| Поиск                 | ✅            | ✅               |
| Просмотр песен        | ✅            | ✅               |
| Избранное             | ✅ (локально) | ✅ (синхр.)      |
| История               | ✅ (локально) | ✅ (синхр.)      |
| Глобальные теги       | ✅            | ✅               |
| Пользовательские теги | ✅ (локально) | ✅ (синхр.)      |
| User Overrides        | ✅ (локально) | ✅ (синхр.)      |
| Оффлайн работа        | ✅            | ❌               |

