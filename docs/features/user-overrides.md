# ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ (User Overrides)

## ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ

Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿ĞµÑĞ½Ğ¸ **Ğ½ĞµĞ¸Ğ·Ğ¼ĞµĞ½ÑĞµĞ¼Ñ‹** â€” Ğ¾Ğ½Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸.

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ **override (Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ)** â€” ÑĞ²Ğ¾Ñ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¿ĞµÑĞ½Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ:
- Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ñ‚ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿ĞµÑĞ½Ğ¸
- ĞŸÑ€Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸ **merge'Ğ¸Ñ‚ÑÑ** Ñ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹
- Ğ’Ğ¸Ğ´Ğ½Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ñ

## Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ

| ĞŸĞ¾Ğ»Ğµ       | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ         |
|------------|------------------|
| `lyric`    | Ğ¢ĞµĞºÑÑ‚ Ğ¿ĞµÑĞ½Ğ¸      |
| `tonality` | Ğ¢Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ      |
| `bibleRef` | Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ñ |
| ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ | Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸   |

## Merge ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ

```
ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ğ°Ñ Ğ¿ĞµÑĞ½Ñ = Global Song + User Override

ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:
1. Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»Ğµ ĞµÑÑ‚ÑŒ Ğ² override â†’ Ğ±ĞµÑ€ĞµĞ¼ Ğ¸Ğ· override
2. Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»Ñ Ğ½ĞµÑ‚ Ğ² override â†’ Ğ±ĞµÑ€ĞµĞ¼ Ğ¸Ğ· global
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€

```kotlin
// Global Song
Song(
    id = 1,
    title = "Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ",
    lyric = "Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ...",
    tonality = "C"
)

// User Override
UserSongOverride(
    songId = 1,
    lyric = "Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ!\n...",  // Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ
    tonality = null  // Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¾
)

// Merged Result
MergedSong(
    id = 1,
    title = "Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ",           // Ğ¸Ğ· global
    lyric = "Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ!\n...",     // Ğ¸Ğ· override
    tonality = "C",                          // Ğ¸Ğ· global
    hasUserOverride = true
)
```

## Use Cases

### GetMergedSongDetailUseCase
```kotlin
class GetMergedSongDetailUseCase(
    private val songRepository: SongReadRepository,
    private val overrideRepository: UserOverrideReadRepository
) {
    suspend operator fun invoke(songId: Long): MergedSongDetail? {
        val song = songRepository.getSong(songId) ?: return null
        val override = overrideRepository.getOverride(songId)
        return merge(song, override)
    }
}
```

### CreateUserSongOverrideUseCase
```kotlin
class CreateUserSongOverrideUseCase(
    private val overrideRepository: UserOverrideWriteRepository
) {
    suspend operator fun invoke(command: CreateOverrideCommand): UserSongOverride
}
```

### UpdateUserSongOverrideUseCase
```kotlin
class UpdateUserSongOverrideUseCase(
    private val overrideRepository: UserOverrideWriteRepository
) {
    suspend operator fun invoke(command: UpdateOverrideCommand)
}
```

### DeleteUserSongOverrideUseCase
```kotlin
class DeleteUserSongOverrideUseCase(
    private val overrideRepository: UserOverrideWriteRepository
) {
    suspend operator fun invoke(songId: Long)
}
```

## ĞœĞ¾Ğ´ĞµĞ»Ğ¸

### UserSongOverride
```kotlin
data class UserSongOverride(
    val id: Long,
    val songId: Long,
    val lyric: String?,        // null = Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¾
    val tonality: String?,
    val bibleRef: String?,
    val notes: String?,        // Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
    val createdAt: Instant,
    val updatedAt: Instant
)
```

### MergedSongDetail
```kotlin
data class MergedSongDetail(
    val song: SongDetail,
    val override: UserSongOverride?,
    val hasUserOverride: Boolean
) {
    // Computed properties
    val effectiveLyric: String
        get() = override?.lyric ?: song.lyric
    
    val effectiveTonality: String?
        get() = override?.tonality ?: song.tonality
}
```

### Commands
```kotlin
data class CreateOverrideCommand(
    val songId: Long,
    val lyric: String? = null,
    val tonality: String? = null,
    val bibleRef: String? = null,
    val notes: String? = null
)

data class UpdateOverrideCommand(
    val overrideId: Long,
    val lyric: String? = null,
    val tonality: String? = null,
    val bibleRef: String? = null,
    val notes: String? = null
)
```

## UI Flow

### Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ override Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ Ğ¿ĞµÑĞ½Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SongScreen                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â† Ğ‘ĞŸ 45                    â¤ï¸  âœï¸  â‹®       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ                        â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âš ï¸ Ğ’Ñ‹ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸ ÑÑ‚Ñƒ Ğ¿ĞµÑĞ½Ñ        â”‚  â”‚  â—€â”€â”€ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ override
â”‚  â”‚    ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ!                       â”‚
â”‚  Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¸Ğ¼Ñ Ğ•Ğ³Ğ¾!                     â”‚
â”‚  ...                                        â”‚
â”‚                                             â”‚
â”‚  Ğ¢Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: C                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ­ĞºÑ€Ğ°Ğ½ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            EditSongScreen                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â† Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ              [ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ğ¢ĞµĞºÑÑ‚ Ğ¿ĞµÑĞ½Ğ¸                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½ Ğ“Ğ¾ÑĞ¿Ğ¾Ğ´ÑŒ!                  â”‚  â”‚
â”‚  â”‚ Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¸Ğ¼Ñ Ğ•Ğ³Ğ¾!                â”‚  â”‚
â”‚  â”‚ ...                                   â”‚  â”‚
â”‚  â”‚                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  Ğ¢Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ C                                   â–¼ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ (Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ĞŸĞµÑ‚ÑŒ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ Ğ²Ğ¾ 2-Ğ¼ ĞºÑƒĞ¿Ğ»ĞµÑ‚Ğµ        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ—‘ï¸ Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ‘ÑƒĞ´ÑƒÑ‰ĞµĞµ: Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

Ğ’ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¼Ğ¾Ğ¶ĞµÑ‚ **Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ** ÑĞ²Ğ¾Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:

```kotlin
class RequestPublishOverrideUseCase(
    private val overrideRepository: UserOverrideWriteRepository
) {
    suspend operator fun invoke(overrideId: Long)
}
```

Workflow:
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿ĞµÑĞ½Ñ (ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ override)
2. ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ"
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ñ
4. ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğº Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿ĞµÑĞ½Ğµ

## Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

- `domain/song/model/UserSongOverride.kt`
- `domain/song/model/MergedSongDetail.kt`
- `domain/song/repository/UserOverrideRepository.kt`
- `domain/song/usecase/GetMergedSongDetailUseCase.kt`
- `domain/song/usecase/CreateUserSongOverrideUseCase.kt`
- `features/song/EditSongScreen.kt`
- `features/song/SongEditViewModel.kt`

