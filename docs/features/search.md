# –ü–æ–∏—Å–∫ –ø–µ—Å–µ–Ω

## –û–ø–∏—Å–∞–Ω–∏–µ

–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø–µ—Å–Ω—è–º —Å–±–æ—Ä–Ω–∏–∫–æ–≤.

## –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∏—Å–∫–∞

### –ü–æ –Ω–æ–º–µ—Ä—É –≤ —Å–±–æ—Ä–Ω–∏–∫–µ
- –í–≤–æ–¥: `123` –∏–ª–∏ `–ë–ü 45`
- –ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—é `SongNumber.number`
- –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞

### –ü–æ —Ç–µ–∫—Å—Ç—É
- –í–≤–æ–¥: –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
- –ü–æ–∏—Å–∫ –ø–æ:
  - –ù–∞–∑–≤–∞–Ω–∏—é –ø–µ—Å–Ω–∏
  - –¢–µ–∫—Å—Ç—É (lyric)
  - –ò–º–µ–Ω–∏ –∞–≤—Ç–æ—Ä–∞
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

## Use Cases

### SearchSongsUseCase
```kotlin
class SearchSongsUseCase(
    private val searchRepository: SearchRepository
) {
    suspend operator fun invoke(
        query: String,
        page: Int = 0,
        size: Int = 20
    ): List<SongSearchResult>
}
```

### SearchSongSuggestionsUseCase
```kotlin
class SearchSongSuggestionsUseCase(
    private val searchRepository: SearchRepository
) {
    suspend operator fun invoke(
        query: String,
        limit: Int = 5
    ): List<SongSearchSuggestion>
}
```

## –ú–æ–¥–µ–ª–∏

### SongSearchResult
```kotlin
data class SongSearchResult(
    val songId: Long,
    val title: String,
    val bookCode: String,
    val number: Int,
    val matchedFields: List<MatchedField>,  // –≥–¥–µ –Ω–∞—à–ª–æ—Å—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    val snippet: String?,                    // —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
    val score: Float                         // —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
)
```

### SongSearchSuggestion
```kotlin
data class SongSearchSuggestion(
    val text: String,        // –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
    val type: SuggestionType // TITLE, NUMBER, AUTHOR
)
```

### MatchedField
```kotlin
enum class MatchedField {
    TITLE,
    LYRIC,
    AUTHOR,
    NUMBER
}
```

## UI Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              SearchScreen                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  üîç –ü–æ–∏—Å–∫ –ø–µ—Å–µ–Ω...                  ‚îÇ    ‚îÇ  ‚óÄ‚îÄ‚îÄ TextField
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  –ü–æ–¥—Å–∫–∞–∑–∫–∏:                         ‚îÇ    ‚îÇ  ‚óÄ‚îÄ‚îÄ Suggestions
‚îÇ  ‚îÇ  ‚Ä¢ –ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω –ì–æ—Å–ø–æ–¥—å              ‚îÇ    ‚îÇ      (–ø–æ—è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ)
‚îÇ  ‚îÇ  ‚Ä¢ –ë–ü 123                           ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:                        ‚îÇ    ‚îÇ  ‚óÄ‚îÄ‚îÄ Search Results
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ –ë–ü 45 - –ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω –ì–æ—Å–ø–æ–¥—å   ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ "...–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω –ì–æ—Å–ø–æ–¥—å..."   ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ –ü–ü 12 - –ë–ª–∞–≥–æ–¥–∞—Ç—å             ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ "...–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã–π –¥–µ–Ω—å..."   ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞

### Local (Room FTS5)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FTS5 –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ò–Ω–¥–µ–∫—Å—ã –ø–æ title, lyric
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

### Remote (Elasticsearch)
- Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Elasticsearch
- –ë–æ–ª–µ–µ —É–º–Ω—ã–π –ø–æ–∏—Å–∫ (fuzzy, synonyms)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

## Debounce

–ü—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è debounce 300ms –¥–ª—è:
- –ü–æ–¥—Å–∫–∞–∑–æ–∫
- –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞

```kotlin
// –í ViewModel
private val searchQuery = MutableStateFlow("")

init {
    searchQuery
        .debounce(300)
        .filter { it.isNotBlank() }
        .distinctUntilChanged()
        .flatMapLatest { query ->
            searchSongsUseCase(query)
        }
        .onEach { results ->
            _uiState.value = SearchUiState.Results(results)
        }
        .launchIn(viewModelScope)
}
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `domain/search/usecase/SearchSongsUseCase.kt`
- `domain/search/usecase/SearchSongSuggestionsUseCase.kt`
- `domain/search/model/SongSearchResult.kt`
- `domain/search/repository/SearchRepository.kt`
- `features/search/SearchScreen.kt`
- `features/search/SearchViewModel.kt`


